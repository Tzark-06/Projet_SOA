package fr.insa.soa.RoomManagementWS.Controller;

import fr.insa.soa.RoomManagementWS.model.*;

import java.util.ArrayList;

import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.client.RestTemplate;

import fr.insa.soa.RoomManagementWS.model.*;

@CrossOrigin
@RestController
public class RoomListResource {
	
	roomList GEIroomList = new roomList();
	
	@GetMapping("/rooms")
	public ArrayList<String> getRooms(){
		return GEIroomList.getRoomList();
	}
	
	
	@GetMapping("/CurrentRoomInfo/{room}")
	public roomEnvironment getCurrentRoomInfo(@PathVariable String room){
		
		RestTemplate newRestTemplate = new RestTemplate();
		
		LightDataAcquisition lightData = newRestTemplate.getForObject("http://localhost:8081/CurrentLight/"+room, LightDataAcquisition.class);
		
		roomEnvironment currentInfo = new roomEnvironment(room, lightData, 22.2, "CLOSED", "OPEN", "YES");
	}
	
	
	@PostMapping("/updateRoomInfo/{room}/{light}")
	public void updateRoomInfo(@PathVariable String room, @PathVariable int light){
		
		RestTemplate newRestTemplate = new RestTemplate();
		
		HttpHeaders headers = new HttpHeaders();
		headers.setContentType(MediaType.APPLICATION_JSON);

		LightDataAcquisition newLight = new LightDataAcquisition();
		newLight.setRoomName(room);
		newLight.setValue(light);
		newLight.setUnit("Lux");

		HttpEntity<LightDataAcquisition> httpEntity = new HttpEntity<>(newLight, headers);
	
		LightDataAcquisition lightData = newRestTemplate.postForObject("http://localhost:8081/LightAcquisition/", httpEntity, LightDataAcquisition.class);
		
		roomEnvironment newRoomInfo = new roomEnvironment(room,  lightData, 25.2, "CLOSED", "OPEN", "YES");
		
		GEIroomList.addRoomToList(newRoomInfo);
	}
	
	
	

}
