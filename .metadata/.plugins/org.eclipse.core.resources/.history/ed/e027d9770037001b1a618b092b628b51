package fr.insa.soa.LightManagementWS.Controller;


import fr.insa.soa.LightManagementWS.model.*;

import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.ArrayList;

import org.springframework.web.bind.annotation.*;

@CrossOrigin
@RestController
public class LightController {
	
	private LightDataDB LightRoomAcquisitionList = new LightDataDB();
	
	
	@GetMapping(value="/CurrentLight/{room}")
	public LightDataAcquisition currentLight(@PathVariable String room){
		return LightRoomAcquisitionList.getLightData(room);
	}
	
	@GetMapping(value="/LightListRoom/{room}")
	public ArrayList<LightDataAcquisition> lightListRoom(@PathVariable String room){
		
		ArrayList<LightDataAcquisition> lightListOfTheRoom = new ArrayList<LightDataAcquisition>();
		
		for(int i = 0; i < LightRoomAcquisitionList.getLightDataList().size(); i++){

			if(LightRoomAcquisitionList.getLightDataList().get(i).getRoomName().equals(room)){
				lightListOfTheRoom.add(LightRoomAcquisitionList.getLightDataList().get(i));
			}
		}	
		return lightListOfTheRoom;
	}
	
	
	/*@PostMapping("/LightAcquisition/{room}/{value}/{unit}")
	public void addLightAcq(@PathVariable String room, @PathVariable int value, @PathVariable String unit){
		LightRoomAcquisitionList.addLightData(value, unit, room);
	}*/
	
	@PostMapping(value = "/createLightData", consumes = "application/json", produces = "application/json")
	public LightDataAcquisition createLightData(@RequestBody LightDataAcquisition lightData) {
	    LightRoomAcquisitionList.addNewLightData(lightData);
	    return lightData;
	}
	
	@PostMapping("/LightAcquisition/{room}/{value}/{unit}")
	public void addLightAcq(@PathVariable String room, @PathVariable int value, @PathVariable String unit) throws IOException{

		URL url = new URL ("http://localhost:8282/ /mn-cse/mn-name/LightSensor/DATA");
		
		HttpURLConnection con = (HttpURLConnection)url.openConnection();
		con.setRequestMethod("POST");
		con.setRequestProperty("Content-Type", "application/json; utf-8");
		
	}
	
		
	
	
}

